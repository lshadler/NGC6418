<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2016 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>CCD gap and bad pixel corrections</TITLE>
<META NAME="description" CONTENT="CCD gap and bad pixel corrections">
<META NAME="keywords" CONTENT="arfgen">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2016">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="arfgen.css">

<LINK REL="next" HREF="node31.html">
<LINK REL="previous" HREF="node29.html">
<LINK REL="up" HREF="node14.html">
<LINK REL="next" HREF="node31.html">
</HEAD>

<BODY TEXT="#000000" BGCOLOR="#FFFFFF" LINK="#0000EE"VLINK="#551A8B" ALINK="#FF0000"><A HREF=http://xmm.esac.esa.int/sas/><IMG SRC="../icons/xmmsaslogo.gif" ALT="XMM-Newton SAS Home Page" HEIGHT=60 WIDTH=60 ALIGN="LEFT"></A>
<DIV ALIGN=RIGHT><B><FONT SIZE=+2>XMM-Newton Science Analysis System</FONT>
<BR>
<BR>
<BR>
arfgen (arfgen-1.93.1) [xmmsas_20170112_1337-16.0.0]</B></DIV>
<BR CLEAR=ALL>

<DIV CLASS="navigation"><A HREF="node29.html"><IMG BORDER="0" SRC="../icons/prev.gif" ALT="Flux loss due to"></A>
<A HREF="node14.html"><IMG BORDER="0" SRC="../icons/up.gif" ALT="Description"></A>
<A HREF="node31.html"><IMG BORDER="0" SRC="../icons/next.gif" ALT="Out of time event"></A>
<A HREF="index.html"><IMG BORDER="0" SRC="../icons/home.gif" ALT="Home"></A>

<A HREF="node44.html"><IMG BORDER="0" SRC="../icons/index.gif" ALT="Index"></A>
<BR><IMG BORDER="0" SRC="../icons/bar.gif">
<BR><A  HREF="../packages.html">Meta Index</A> / <A  HREF="arfgen.html">Home Page</A> / <A  HREF="node14.html">Description</A></DIV>
<!--End of Navigation Panel-->

<H2><A NAME="SECTION000610000000000000000"></A>
<A NAME="arfgen:description:description:bpc"></A>
<BR>
CCD gap and bad pixel corrections
</H2>

<P>
By default the task will reduce the effective area produced in the ARF
if the source area contains bad pixels/columns or contains area which lies
outside the CCD boundaries. For an extended source this reduction is
simply the ratio of the dead area within the source region to the good area.
For point sources a fine grid is used to determine the contribution to
the enclosed energy of each dead point, i.e. the dead regions are 
normalised by the fraction of the point spread function lying within that 
region before being subtracted from
the total effective area. The task uses the parameter <TT>extendedsource</TT>
to choose between these options. Although the correction for point sources
is quite good the extended source correction assumes a uniform surface
brightness of the source. If this condition is not met then quite large
errors can be introduced. A way to avoid this potential source of error is 
to apply a detector mask in the accumulation of extended source spectra. 
The detector mask is a binary (1/0) detector image, where all CCD "dead" 
areas are set to 0. The masked out pixels are not used in the calculation 
of the effective area (see 
section&nbsp;<A HREF="node17.html#arfgen:description:description:imask">5.2.1</A>).
Hence, the integrated effective area over the extended source surface brightness takes into account only the fraction of the source which has been 
effectively imaged.

<BR>
A detector mask is generated with <A NAME="1426"></A><A NAME="tex2html50"
  HREF="../emask/index.html"><SPAN  CLASS="textbf">emask</SPAN></A>
starting from an exposure map 
as generated by <A NAME="1430"></A><A NAME="tex2html51"
  HREF="../eexpmap/index.html"><SPAN  CLASS="textbf">eexpmap</SPAN></A>, which in turn requires an image generated 
by <A NAME="1434"></A><A NAME="tex2html52"
  HREF="../evselect/index.html"><SPAN  CLASS="textbf">evselect</SPAN></A>
or <A NAME="1438"></A><A NAME="tex2html53"
  HREF="../xmmselect/index.html"><SPAN  CLASS="textbf">xmmselect</SPAN></A>. In command-line terms:

<P>
<TT>eexpmap imageset=field_of_view.img attitudeset=0060_0122700101_AttHk.ds 
<BR>
eventset=0060_0122700101_EPN_S001_ImagingEvts.ds 
<BR>
expimageset=exposure_map.fits pimin=1000 pimax=10000
</TT>
<P>
<TT>emask expimageset=exposure_mask.fits detmaskset=detector_mask.fits
</TT>

<P>
If the fraction of counts, lost to bad pixels and chip gaps is large, then it is recommended to use a finer resolution when determining this contribution.
A warning is issued by the program if it sees that the resolution used is
too coarse.

<P>
In a similar way the task corrects for area of the source region which
is outside the FOV (selectable with the parameter <TT>ignoreoutoffov</TT>), 
outside the observing window or on a CCD explicitly
excluded by a CCD selection within the data subspace.

<P>
This behaviour can be turned off by setting <TT>withbadpixcorr=false</TT>.
CCD gaps and area outside the FOV are automatically corrected for if <TT>withbadpixcorr=true</TT>.
To correct for bad pixels, a file containing bad pixel extensions must
be specified on the command line by <TT>badpixlocation</TT>=<I>file</I>. The
bad pixel information is usually stored in the event file from which
the spectrum was constructed. Bad columns and bad rows (MOS only) are also 
handled if they are specified in the OFFSETS column of the <TT>badpixlocation</TT> file. Pixels adjacent to chip gaps, bad pixels and bad columns
are also corrected for if the FLAG selection
in the datasubspace has been set accordingly. The code checks each bit mask
in the event flag to see if pixels next to a particular type of bad pixel 
or bad column should be excluded. In this way spectra created with, for example, the #XMMEA_EM and #XMMEA_SM flagging can produce different effective areas
for certain selection regions.

<P>
We recommend users to utilize #XMMEA_EM for accumulating EPIC-MOS spectra. 
Spectra extracted using this selection criteria have been demonstrated to 
be in agreement with the EPIC calibration status document 
(http://xmm2.esac.esa.int/docs/documents/CAL-TN-0018.pdf).

<P>
The task creates temporary files called BADPIXnn.ds, where nn is the
CCD number, in the current directory while calculating the bad pixel 
correction. To make these files permanent specify 
<TT>withfilteredset</TT> <SPAN CLASS="MATH"><IMG
 WIDTH="16" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img1.png"
 ALT="$=$"></SPAN> <TT>yes</TT>
on the command line.

<P>

<DIV CLASS="navigation"><IMG BORDER="0" SRC="../icons/bar.gif">
<BR><A HREF="node29.html"><IMG BORDER="0" SRC="../icons/prev.gif" ALT="Flux loss due to"></A>
<A HREF="node14.html"><IMG BORDER="0" SRC="../icons/up.gif" ALT="Description"></A>
<A HREF="node31.html"><IMG BORDER="0" SRC="../icons/next.gif" ALT="Out of time event"></A>
<A HREF="index.html"><IMG BORDER="0" SRC="../icons/home.gif" ALT="Home"></A>

<A HREF="node44.html"><IMG BORDER="0" SRC="../icons/index.gif" ALT="Index"></A>
</DIV>
<!--End of Navigation Panel-->
<ADDRESS>
XMM-Newton SOC/SSC -- 2017-01-12
</ADDRESS>
</BODY>
</HTML>
