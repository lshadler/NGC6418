<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2016 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Description</TITLE>
<META NAME="description" CONTENT="Description">
<META NAME="keywords" CONTENT="omlcbuild">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2016">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="omlcbuild.css">

<LINK REL="next" HREF="node4.html">
<LINK REL="previous" HREF="node2.html">
<LINK REL="up" HREF="omlcbuild.html">
<LINK REL="next" HREF="node4.html">
</HEAD>

<BODY TEXT="#000000" BGCOLOR="#FFFFFF" LINK="#0000EE"VLINK="#551A8B" ALINK="#FF0000"><A HREF=http://xmm.esac.esa.int/sas/><IMG SRC="../icons/xmmsaslogo.gif" ALT="XMM-Newton SAS Home Page" HEIGHT=60 WIDTH=60 ALIGN="LEFT"></A>
<DIV ALIGN=RIGHT><B><FONT SIZE=+2>XMM-Newton Science Analysis System</FONT>
<BR>
<BR>
<BR>
omlcbuild (omlcbuild-1.40) [xmmsas_20170112_1337-16.0.0]</B></DIV>
<BR CLEAR=ALL>

<DIV CLASS="navigation"><A HREF="node2.html"><IMG BORDER="0" SRC="../icons/prev.gif" ALT="Use"></A>
<A HREF="omlcbuild.html"><IMG BORDER="0" SRC="../icons/up.gif" ALT="Home Page"></A>
<A HREF="node4.html"><IMG BORDER="0" SRC="../icons/next.gif" ALT="Parameters"></A>
<A HREF="index.html"><IMG BORDER="0" SRC="../icons/home.gif" ALT="Home"></A>

<A HREF="node12.html"><IMG BORDER="0" SRC="../icons/index.gif" ALT="Index"></A>
<BR><IMG BORDER="0" SRC="../icons/bar.gif">
<BR><A  HREF="../packages.html">Meta Index</A> / <A  HREF="omlcbuild.html">Home Page</A></DIV>
<!--End of Navigation Panel-->

<H1><A NAME="SECTION00030000000000000000"></A>
<A NAME="omlcbuild:description:description"></A>
<BR>
Description
</H1>

<P>
This task constructs the PPS product OM OSW FITS source timeseries
from two rate files (source and background) produced by separate runs of 
<SMALL>EVSELECT</SMALL> on a tracking-shifted, QE-corrected OM fast-mode
event-list. The output timeseries has 4 columns (background subtracted
source rate &amp; error, background rate &amp; error). All rates are in counts/s. 

<P>
In addition to the two rate files, the two region files (generated by <SMALL>OMREGION</SMALL>) are read to deduce the extraction areas. The following procedure is
performed for each time bin. The counts measured in the source and `background`
regions, together with the PSF function evaluated over the corresponding
regions, are used to set up equations which are then solved to yield source and
background rates evaluated for the nominal coincidence-loss region (r=12
pixels). If the parameter <I CLASS="sans">bkgfromimage</I> was set to `<I CLASS="sans">yes</I>' then the
task would read the Imaging-mode data file (image), remove all the sources from this
image and calculate the average value of the background level. This value will 
be used in further processing, so the output background light-curve will be 
constant. Note that allowance is made for proximity of the source to the edge of
the OSW - the fraction of PSF which falls out of the window is restored.  These
rates are separately corrected for coincidence losses.  Subsequent background
subtraction, followed by the corrections for dead-time and any PSF beyond 12
pixels, leads to the final source rate. The code allows for cases where the
time-binning of the source and `background` rate files differ a little - linear
interpolation is employed and the binning and timing alignment of the emerging
source light curve matches that of the input source rate file.

<P>
Errors are computed assuming Poisson statistics though a systematic error of 
2% is later included as a measure of non-Poissonian effects at high 
count rates. 

<P>
The basic procedure implemented in the task 
is as follows:

<P>

<UL>
<LI>1. Get the photometry aperture radius from CAL
</LI>
<LI>2. Get CAL aperture radius 
</LI>
<LI>3. Compute the correction factor in the case the photometry aperture radius
   is greater than the CAL aperture radius in order to later scale the counts
   to the CAL aperture radius.
</LI>
<LI>4. Compute the count rate corresponding to the OM detection limit
</LI>
<LI>5. If the use of the Imaging-mode window is requested for computing
the background level, then read the image corresponding to this window,
remove all the sources from this image, and calculate the average 
value of the Imaging-mode background.
</LI>
<LI>6. Get the list of sources seen in the science window
</LI>
<LI>7. For each of these sources:
</LI>
<LI>7.1. Compute the source and background regions corresponding to the
       radii given in the source list (the background region is an 
       annulus; the window size is not yet taken into account).
       These regions have been used by "Evselect" for extracting the 
       events corresponding to the source and its background.
</LI>
<LI>7.2. Check for the neighbouring sources which may contribute to 
       the counts obtained by Evselect. These regions corresponding
       to these sources are avoided when computing the background.
</LI>
<LI>7.3. Calculate the median value of the background (this value
       is used for representing the error bars in cases when the 
       source and background rate columns are not present in the 
       data set).  
</LI>
<LI>7.4. Check whether the MOD8FLAG is set to true
</LI>
<LI>7.5. Compute the PSF map corresponding to the source
</LI>
<LI>7.6. Compute the real source and background extraction areas
       (the neighbouring sources are avoided when computing the 
       background area), as well as the PSF-fractions corresponding
       to these areas.
</LI>
<LI>7.7. Compute the PSF-fractions within and outside of the OM science
       window
</LI>
<LI>7.8. Compute the ratios (scaling factors) between the PSF-fractions 
       corresponding to the extraction, CAL, and photometric radii 
       (the extraction radius is not necessarily the same as the CAL 
       radius, and the latter is not necessarily the same as the 
       photometry radius).
</LI>
<LI>7.9. Build the light-curves (loop through all of the time bins).
</LI>
<LI>7.9.1. If the option <I CLASS="sans">bkgfromimage</I> is set to <I CLASS="sans">`` yes''</I>
            then use the Imaging-mode background value, otherwise 
            compute the background by solving the system of two
            equations with two unknowns, using the source and 
            background extraction areas and PSF-fractions, and,
            of course, the counts from the source and background 
            columns of the input data table. If the source is 
            very bright and the count rates are badly affected by 
            the coincidence losses and modulo-8 noise then 
            nullify the background, assuming that neglecting
            the background in such cases is a more robust procedure
            than computing a wrong background value due to the 
            modulo-8 noise pattern. 
</LI>
<LI>7.9.2. Subtract the background value from the data corresponding
            to the source column (initially, in this column we 
            have the source+background counts).
</LI>
<LI>7.9.3. Correct the source counts for the PSF-fraction outside
            of the science window. These will be the counts extracted
            from the region having the source extraction radius. 
</LI>
<LI>7.9.4. Convert the source and background counts to count rates 
            by dividing them by the time bin value. 
</LI>
<LI>7.9.5. Scale the background counts to the area corresponding to 
            the source extraction radius.
</LI>
<LI>7.9.6. Scale the source and background count rates to the 
            CAL aperture radius.
</LI>
<LI>7.9.7. Compute the sum of the source and background count rates.
</LI>
<LI>7.9.8. Correct the background value for the coincidence losses by
            using the CAL routine with the frame time and dead fraction
            as input parameters.
</LI>
<LI>7.9.9. Correct the background value for the time-dependent
            sensitivity of the photodetector. 
</LI>
<LI>7.9.10. Correct the source+background value for the coincidence
             losses by using the CAL routine with the frame time and
             dead fraction as input parameters.
</LI>
<LI>7.9.11. Correct the source+background value for the time-dependent
             sensitivity of the photodetector. 
</LI>
<LI>7.9.12. If the ratio of the coincidence-loss corrected count rate
             to the initial count rate exceeds 2.0 then flag this 
             time bin as having high-coincidence losses. 
</LI>
<LI>7.9.13. Subtract the background 
</LI>
<LI>7.9.14. Compute the source and background magnitudes.
</LI>
<LI>8.0. Compute average count rates and magnitudes for the entire light curve.
</LI>
<LI>9.0. Perform the source variability tests for the entire light curve. 
</LI>
</UL>

<P>

<DIV CLASS="navigation"><IMG BORDER="0" SRC="../icons/bar.gif">
<BR><A HREF="node2.html"><IMG BORDER="0" SRC="../icons/prev.gif" ALT="Use"></A>
<A HREF="omlcbuild.html"><IMG BORDER="0" SRC="../icons/up.gif" ALT="Home Page"></A>
<A HREF="node4.html"><IMG BORDER="0" SRC="../icons/next.gif" ALT="Parameters"></A>
<A HREF="index.html"><IMG BORDER="0" SRC="../icons/home.gif" ALT="Home"></A>

<A HREF="node12.html"><IMG BORDER="0" SRC="../icons/index.gif" ALT="Index"></A>
</DIV>
<!--End of Navigation Panel-->
<ADDRESS>
XMM-Newton SOC/SSC -- 2017-01-12
</ADDRESS>
</BODY>
</HTML>
