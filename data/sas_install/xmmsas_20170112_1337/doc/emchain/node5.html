<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2016 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Main loop</TITLE>
<META NAME="description" CONTENT="Main loop">
<META NAME="keywords" CONTENT="emchain">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2016">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="emchain.css">

<LINK REL="next" HREF="node6.html">
<LINK REL="previous" HREF="node4.html">
<LINK REL="up" HREF="node3.html">
<LINK REL="next" HREF="node6.html">
</HEAD>

<BODY TEXT="#000000" BGCOLOR="#FFFFFF" LINK="#0000EE"VLINK="#551A8B" ALINK="#FF0000"><A HREF=http://xmm.esac.esa.int/sas/><IMG SRC="../icons/xmmsaslogo.gif" ALT="XMM-Newton SAS Home Page" HEIGHT=60 WIDTH=60 ALIGN="LEFT"></A>
<DIV ALIGN=RIGHT><B><FONT SIZE=+2>XMM-Newton Science Analysis System</FONT>
<BR>
<BR>
<BR>
emchain (emchain-11.19) [xmmsas_20170112_1337-16.0.0]</B></DIV>
<BR CLEAR=ALL>

<DIV CLASS="navigation"><A HREF="node4.html"><IMG BORDER="0" SRC="../icons/prev.gif" ALT="Generalities"></A>
<A HREF="node3.html"><IMG BORDER="0" SRC="../icons/up.gif" ALT="Description"></A>
<A HREF="node6.html"><IMG BORDER="0" SRC="../icons/next.gif" ALT="Flare rejection"></A>
<A HREF="index.html"><IMG BORDER="0" SRC="../icons/home.gif" ALT="Home"></A>

<A HREF="node20.html"><IMG BORDER="0" SRC="../icons/index.gif" ALT="Index"></A>
<BR><IMG BORDER="0" SRC="../icons/bar.gif">
<BR><A  HREF="../packages.html">Meta Index</A> / <A  HREF="emchain.html">Home Page</A> / <A  HREF="node3.html">Description</A></DIV>
<!--End of Navigation Panel-->

<H2><A NAME="SECTION00032000000000000000"></A>
<A NAME="emchain:description:description:main"></A>
<BR>
Main loop
</H2>

<P>

<DIV ALIGN="CENTER"><A NAME="emchain:description:description:main:merge"></A><A NAME="185"></A>
<TABLE>
<CAPTION ALIGN="BOTTOM"><STRONG>Figure 1:</STRONG>
Organisation of the EPIC-MOS chain: merging the event lists. 
The files in boldly dashed boxes are used (or produced) if they exist.
The files in simply dashed boxes are options of the individual tasks
not used in the current chain.</CAPTION>
<TR><TD><IMG
 WIDTH="711" HEIGHT="807" BORDER="0"
 SRC="img1.png"
 ALT="\begin{figure}\centerline{\psfig{figure=imaging1.eps,width=\textwidth}}\end{figure}"></TD></TR>
</TABLE>
</DIV>

<P>
The main subroutine 
(processOdf, Fig <A HREF="#emchain:description:description:main:merge">1</A>) 
loops over all exposures 
and instruments (MOS1/MOS2) 
present in the input directory (looking for event list files).

<P>
If <TT>withatthkgen</TT> is true or if the tracking history file does not exist
already, <A NAME="818"></A><A NAME="tex2html9"
  HREF="../atthkgen/index.html"><SPAN  CLASS="textbf">atthkgen</SPAN></A>
is run first.
<A NAME="822"></A><A NAME="tex2html10"
  HREF="../tabgtigen/index.html"><SPAN  CLASS="textbf">tabgtigen</SPAN></A>
is run on the output to generate the attitude GTI.
The tolerance on attitude variations may be modified via <TT>atttol</TT>.
<A NAME="827"></A><A NAME="tex2html11"
  HREF="../hkgtigen/index.html"><SPAN  CLASS="textbf">hkgtigen</SPAN></A>
is run if the HK GTI does not exist already.
Those GTI files are not applied by default, they are generated for information.
They can be applied by setting <TT>filteratt</TT>=Y and/or <TT>filterhk</TT>=Y.
They are then merged with the user GTI (if <TT>ingtiset</TT> is set)
into the external GTI used by <A NAME="834"></A><A NAME="tex2html12"
  HREF="../emframes/index.html"><SPAN  CLASS="textbf">emframes</SPAN></A>.

<P>
processOdf creates one (or two, if a CCD is
operated in TIMING mode) event list for every selected exposure, from all
relevant ODF material and (if they exist) the good time intervals 
generated by <A NAME="838"></A><A NAME="tex2html13"
  HREF="../tabgtigen/index.html"><SPAN  CLASS="textbf">tabgtigen</SPAN></A>
and the list of bad pixels 
(from the CCF or produced internally).

<P>

<DIV ALIGN="CENTER"><A NAME="emchain:description:description:main:ccdloop"></A><A NAME="726"></A>
<TABLE>
<CAPTION ALIGN="BOTTOM"><STRONG>Figure 2:</STRONG>
Organisation of the EPIC-MOS chain at CCD/node level 
with file inputs. 
Same conventions as in Fig <A HREF="#emchain:description:description:main:merge">1</A></CAPTION>
<TR><TD><IMG
 WIDTH="713" HEIGHT="868" BORDER="0"
 SRC="img2.png"
 ALT="\begin{figure}\centerline{\psfig{figure=imaging0.eps,width=\textwidth}}\end{figure}"></TD></TR>
</TABLE>
</DIV>

<P>
In a first step it loops over all CCD/nodes, calling in sequence,
as shown in Fig <A HREF="#emchain:description:description:main:ccdloop">2</A>:

<OL>
<LI><A NAME="842"></A><A NAME="tex2html14"
  HREF="../emframes/index.html"><SPAN  CLASS="textbf">emframes</SPAN></A>
on the auxiliary file, the events file
      and the external GTI file (if any), creating a frame file as expected
      by <A NAME="846"></A><A NAME="tex2html15"
  HREF="../emevents/index.html"><SPAN  CLASS="textbf">emevents</SPAN></A>
and a CCD/node specific GTI file which will be
      reinjected in the final call to <A NAME="850"></A><A NAME="tex2html16"
  HREF="../evselect/index.html"><SPAN  CLASS="textbf">evselect</SPAN></A>.
</LI>
<LI><A NAME="854"></A><A NAME="tex2html17"
  HREF="../badpix/index.html"><SPAN  CLASS="textbf">badpix</SPAN></A>
on the events list, adding the <A NAME="858"></A><TT>BADPIX</TT> extension.

If a bad pixels file exists, it is used instead of the CAL calls
      for the non-uplinked bad pixels,
      (<I>i.e.</I> <A NAME="860"></A><A NAME="tex2html18"
  HREF="../badpix/index.html"><SPAN  CLASS="textbf">badpix</SPAN></A>
is called with <TT>getuplnkbadpix</TT>=Y
      <TT>getotherbadpix</TT>=N <TT>getnewbadpix</TT>=Y).
</LI>
<LI><A NAME="867"></A><A NAME="tex2html19"
  HREF="../emevents/index.html"><SPAN  CLASS="textbf">emevents</SPAN></A>
on the events list, the offset/variance file and
      the frame file, creating a new events list which will be propagated
      through <A NAME="871"></A><A NAME="tex2html20"
  HREF="../attcalc/index.html"><SPAN  CLASS="textbf">attcalc</SPAN></A>
and <A NAME="875"></A><A NAME="tex2html21"
  HREF="../emenergy/index.html"><SPAN  CLASS="textbf">emenergy</SPAN></A>
to <A NAME="879"></A><A NAME="tex2html22"
  HREF="../evlistcomb/index.html"><SPAN  CLASS="textbf">evlistcomb</SPAN></A>.
</LI>
<LI><A NAME="883"></A><A NAME="tex2html23"
  HREF="../gtialign/index.html"><SPAN  CLASS="textbf">gtialign</SPAN></A>
on the external GTI file and the events file, then

<A NAME="887"></A><A NAME="tex2html24"
  HREF="../gtimerge/index.html"><SPAN  CLASS="textbf">gtimerge</SPAN></A>
to merge the resulting aligned GTI
      and the CCD/node specific GTI.
</LI>
<LI><A NAME="891"></A><A NAME="tex2html25"
  HREF="../attcalc/index.html"><SPAN  CLASS="textbf">attcalc</SPAN></A>
on the new events list,
      filling the <A NAME="895"></A><TT>X</TT>/<A NAME="897"></A><TT>Y</TT> columns.
</LI>
<LI><A NAME="899"></A><A NAME="tex2html26"
  HREF="../emenergy/index.html"><SPAN  CLASS="textbf">emenergy</SPAN></A>
on the new events list, 
      filling the <A NAME="903"></A><TT>FLAG</TT>, <A NAME="905"></A><TT>PHA</TT> and <A NAME="907"></A><TT>PI</TT> columns.
</LI>
</OL>

<P>
By default position, energy and time of each photon are randomised
within their respective bins (one CCD pixel for position, one ADU for energy,
one frame for time).

<P>
Then (Fig <A HREF="#emchain:description:description:main:merge">1</A>) 
all the event list files created 
(one per CCD/node) are merged by
<A NAME="909"></A><A NAME="tex2html27"
  HREF="../evlistcomb/index.html"><SPAN  CLASS="textbf">evlistcomb</SPAN></A>, creating one events list per mode (IMAGING, TIMING).
Finally <A NAME="913"></A><A NAME="tex2html28"
  HREF="../evselect/index.html"><SPAN  CLASS="textbf">evselect</SPAN></A>
is called on the resulting events list(s), with
(CCDNR==$node$ccd) &amp;&amp; GTI(merged GTI file,TIME) for all CCD/nodes.
<A NAME="917"></A><A NAME="tex2html29"
  HREF="../emtaglenoise/index.html"><SPAN  CLASS="textbf">emtaglenoise</SPAN></A>
loops over all CCDs (except the central one) to check
occurrence of low-energy electronic noise and write the <A NAME="921"></A><TT>LENOISnn</TT>
keyword, set to 1 if a CCD is affected.
The list of calibration files used to analyse the data is added
to the output files as a <A NAME="923"></A><TT>CALINDEX</TT> extension.

<P>

<DIV CLASS="navigation"><IMG BORDER="0" SRC="../icons/bar.gif">
<BR><A HREF="node4.html"><IMG BORDER="0" SRC="../icons/prev.gif" ALT="Generalities"></A>
<A HREF="node3.html"><IMG BORDER="0" SRC="../icons/up.gif" ALT="Description"></A>
<A HREF="node6.html"><IMG BORDER="0" SRC="../icons/next.gif" ALT="Flare rejection"></A>
<A HREF="index.html"><IMG BORDER="0" SRC="../icons/home.gif" ALT="Home"></A>

<A HREF="node20.html"><IMG BORDER="0" SRC="../icons/index.gif" ALT="Index"></A>
</DIV>
<!--End of Navigation Panel-->
<ADDRESS>
XMM-Newton SOC/SSC -- 2017-01-12
</ADDRESS>
</BODY>
</HTML>
